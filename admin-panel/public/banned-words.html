<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deal Baron Admin - Yasaklƒ± Kelimeler</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar will be loaded by sidebar.js -->

        <main class="main-content">
            <header class="header">
                <h1>Yasaklƒ± Kelimeler</h1>
                <div class="header-actions">
                    <button onclick="location.reload()" class="btn-refresh">üîÑ Yenile</button>
                </div>
            </header>
            <div class="section">
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr><th>Kelime</th><th>Kategori</th><th>Eklenme Tarihi</th><th>ƒ∞≈ülemler</th></tr>
                        </thead>
                        <tbody id="wordsTable">
                            <tr><td colspan="4" class="loading">Y√ºkleniyor...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
    <script src="js/auth.js"></script>
    <script src="js/sidebar.js"></script>
    <script src="js/api.js"></script>
    <script>
        checkAuth();

        async function loadWords() {
            try {
                const result = await api.get('/admin/banned-words');
                if (result.success) {
                    displayWords(result.data.words);
                } else {
                    showNotification('Yasaklƒ± kelimeler y√ºklenirken hata olu≈ütu', 'error');
                }
            } catch (error) {
                console.error('Load words error:', error);
                showNotification('Sunucu hatasƒ±', 'error');
            }
        }

        function displayWords(words) {
            const tbody = document.getElementById('wordsTable');

            if (!words || words.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data">Hen√ºz yasaklƒ± kelime bulunmuyor</td></tr>';
                return;
            }

            tbody.innerHTML = words.map(word => `
                <tr>
                    <td><strong>${word.word}</strong></td>
                    <td><span class="badge badge-${getCategoryColor(word.category)}">${word.category || 'other'}</span></td>
                    <td class="badge badge-${getSeverityColor(word.severity)}">${word.severity || 'medium'}</span></td>
                    <td>${new Date(word.createdAt).toLocaleDateString('tr-TR')}</td>
                    <td>
                        <button onclick="testWord('${word.word}')" class="btn-sm info">üß™ Test</button>
                        <button onclick="editWord('${word._id}', '${word.word}', '${word.category}', '${word.severity}')" class="btn-sm secondary">‚úèÔ∏è D√ºzenle</button>
                        <button onclick="deleteWord('${word._id}')" class="btn-sm danger">üóëÔ∏è Sil</button>
                    </td>
                </tr>
            `).join('');
        }

        function getCategoryColor(category) {
            const colors = {
                'spam': 'danger',
                'insult': 'danger',
                'politics': 'warning',
                'violence': 'danger',
                'other': 'secondary'
            };
            return colors[category] || 'secondary';
        }

        function getSeverityColor(severity) {
            const colors = {
                'high': 'danger',
                'medium': 'warning',
                'low': 'info'
            };
            return colors[severity] || 'secondary';
        }

        async function testWord(word) {
            try {
                const result = await api.post('/admin/banned-words/check', { text: word });
                if (result.success) {
                    const msg = result.data.isClean
                        ? `"${word}" kelimesi temiz`
                        : `"${word}" kelimesi yasaklanmƒ±≈ü! Bulunan: ${result.data.foundWords.join(', ')}`;
                    alert(msg);
                }
            } catch (error) {
                console.error('Test word error:', error);
                alert('Test i≈ülemi ba≈üarƒ±sƒ±z');
            }
        }

        function editWord(id, word, category, severity) {
            // Simple edit implementation
            const newWord = prompt('Yeni kelime:', word);
            if (newWord && newWord !== word) {
                updateWord(id, { word: newWord, category, severity });
            }
        }

        async function updateWord(id, updates) {
            try {
                const result = await api.put('/admin/banned-words/' + id, updates);
                if (result.success) {
                    showNotification('Kelime g√ºncellendi', 'success');
                    loadWords();
                }
            } catch (error) {
                console.error('Update word error:', error);
                showNotification('G√ºncelleme ba≈üarƒ±sƒ±z', 'error');
            }
        }

        async function deleteWord(id) {
            if (!confirm('Bu kelimeyi silmek istediƒüinizden emin misiniz?')) return;

            try {
                const result = await api.delete('/admin/banned-words/' + id);
                if (result.success) {
                    showNotification('Kelime silindi', 'success');
                    loadWords();
                }
            } catch (error) {
                console.error('Delete word error:', error);
                showNotification('Silme ba≈üarƒ±sƒ±z', 'error');
            }
        }

        function showNotification(message, type = 'info') {
            alert(message);
        }

        // Load words on page load
        loadWords();
    </script>
</body>
</html>
